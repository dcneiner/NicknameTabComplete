/*! 
 * Nickname Tab Complete
 * Copyright (c) Doug Neiner, 2010. Dual licenses under MIT or GPL
 *
 * Includes one function from jQuery plugin: fieldSelection - v0.1.1 (c) 2006 Alex Brem <alex@0xab.cd> - http://blog.0xab.cd (Open Source)
 * 
 * And two functions from an answer 
 * by CMS (http://stackoverflow.com/users/5445/cms) on Stack Overflow:
 * http://stackoverflow.com/questions/499126/jquery-set-cursor-position-in-text-area
 *
 */
(function(h){function k(a){return("selectionStart"in a&&function(){var c=a.selectionEnd-a.selectionStart;return{start:a.selectionStart,end:a.selectionEnd,length:c,text:a.value.substr(a.selectionStart,c)}}||document.selection&&function(){a.focus();var c=document.selection.createRange();if(c===null)return{start:0,end:a.value.length,length:0};var e=a.createTextRange(),b=e.duplicate();e.moveToBookmark(c.getBookmark());b.setEndPoint("EndToStart",e);return{start:b.text.length,end:b.text.length+c.text.length,
length:c.text.length,text:c.text}}||function(){return null})()}function l(a,c){var e=a.toLowerCase(),b=[],d=a.length,f="",g,i=0;h.each(c,function(m,j){j.toLowerCase().substr(0,d)===e&&b.push(j)});if(b.length===1)return b[0];else if(b.length>1){for(;i<b[0].length-d;i+=1){g=b[0].toLowerCase().substr(d+i,1);h.each(b,function(m,j){if(j.toLowerCase().substr(d+i,1)!==g){g="";return false}});if(g)f+=g;else break}return a+f}return""}function n(a,c){if(a.which===9){var e=h(this),b=e.val(),d=k(this),f="",g=
"",i;if(!d.length&&d.start){f=b.substr(0,d.start);if(c.nick_match.test(f)){f=f.match(c.nick_match)[1];if(g=l(f,c.nicknames)){i=b.slice(0,d.start-f.length);b=b.slice(d.start);e.val(i+g+b);e=d.start-f.length+g.length;if(this.setSelectionRange){this.focus();this.setSelectionRange(e,e)}else if(this.createTextRange){d=this.createTextRange();d.collapse(true);d.moveEnd("character",e);d.moveStart("character",e);d.select()}}a.preventDefault()}}}}h.fn.nicknameTabComplete=function(a){a=h.extend({},h.fn.nicknameTabComplete.defaults,
a);return this.bind("keydown",function(c){n(c,a)})};h.fn.nicknameTabComplete.defaults={nicknames:[],nick_match:/@([-_a-z]*)$/i}})(jQuery);