/*! 
 * Nickname Tab Complete
 * Copyright (c) Doug Neiner, 2010. Dual licenses under MIT or GPL
 *
 * Includes one function from jQuery plugin: fieldSelection - v0.1.1 (c) 2006 Alex Brem <alex@0xab.cd> - http://blog.0xab.cd (Open Source)
 * 
 * And two functions from an answer 
 * by CMS (http://stackoverflow.com/users/5445/cms) on Stack Overflow:
 * http://stackoverflow.com/questions/499126/jquery-set-cursor-position-in-text-area
 *
 */
(function(i){function k(b){return("selectionStart"in b&&function(){var d=b.selectionEnd-b.selectionStart;return{start:b.selectionStart,end:b.selectionEnd,length:d,text:b.value.substr(b.selectionStart,d)}}||document.selection&&function(){b.focus();var d=document.selection.createRange();if(d===null)return{start:0,end:b.value.length,length:0};var g=b.createTextRange(),a=g.duplicate();g.moveToBookmark(d.getBookmark());a.setEndPoint("EndToStart",g);return{start:a.text.length,end:a.text.length+d.text.length,
 length:d.text.length,text:d.text}}||function(){return null})()}function l(b,d){var g=b.toLowerCase(),a=[],f=b.length,c="",e,h=0;i.each(d,function(m,j){j.toLowerCase().substr(0,f)===g&&a.push(j)});if(a.length===1)return{value:a[0],matches:a};else if(a.length>1){for(;h<a[0].length-f;h+=1){e=a[0].toLowerCase().substr(f+h,1);i.each(a,function(m,j){if(j.toLowerCase().substr(f+h,1)!==e){e="";return false}});if(e)c+=e;else break}return{value:b+c,matches:a}}return{value:"",matches:a}}i.fn.nicknameTabComplete=
 function(b){b=i.extend({},i.fn.nicknameTabComplete.defaults,b);return this.bind("keydown",function(d){var g=b;if(d.which===9){var a=i(this),f=a.val(),c=k(this),e="",h="";if(!c.length&&c.start){e=f.substr(0,c.start);if(g.nick_match.test(e)){e=e.match(g.nick_match)[1];h=l(e,g.nicknames);if(h.value){g=f.slice(0,c.start-e.length);f=f.slice(c.start);space=h.matches.length>1||f.length&&f[0]==" "?"":" ";a.val(g+h.value+space+f);a=c.start-e.length+h.value.length+space.length;if(this.setSelectionRange){this.focus();
 this.setSelectionRange(a,a)}else if(this.createTextRange){c=this.createTextRange();c.collapse(true);c.moveEnd("character",a);c.moveStart("character",a);c.select()}}d.preventDefault()}}}})};i.fn.nicknameTabComplete.defaults={nicknames:[],nick_match:/@([-_a-z]*)$/i}})(jQuery);